(()=>{"use strict";var e,r={961(){const e=window.wp.blocks,r=window.wp.i18n,s=window.wp.blockEditor,t=window.wp.components,n=window.wp.data,l=window.wp.element,a=window.wp.primitives,o=window.ReactJSXRuntime;var c=(0,o.jsx)(a.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)(a.Path,{d:"M6.5 12.4L12 8l5.5 4.4-.9 1.2L12 10l-4.5 3.6-1-1.2z"})}),p=(0,o.jsx)(a.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)(a.Path,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"})});const i=JSON.parse('{"UU":"gatherpress/references"}');(0,e.registerBlockType)(i.UU,{edit:function({attributes:e,setAttributes:a}){const{postType:i,refTermId:f,year:h,referenceType:u,headingLevel:g,yearSortOrder:d,typeOrder:y}=e,_=(0,n.useSelect)(e=>{const r=e("core").getPostTypes({per_page:-1});return r?r.filter(e=>e.supports&&e.supports.gatherpress_references):[]},[]);(0,l.useEffect)(()=>{i||1!==_.length||a({postType:_[0].slug})},[i,_,a]);const m=(0,l.useMemo)(()=>i||(_.length>0?_[0].slug:null),[i,_]),x=(0,n.useSelect)(e=>{if(!m)return null;const r=e("core").getPostType(m);if(!r||!r.supports)return null;const s=r.supports.gatherpress_references;return s?Array.isArray(s)&&s.length>0?s[0]:"object"==typeof s&&null!==s?s:null:null},[m]),{refTaxonomy:v,refTerms:w}=(0,n.useSelect)(e=>x&&x.ref_tax?{refTaxonomy:e("core").getTaxonomy(x.ref_tax)||null,refTerms:e("core").getEntityRecords("taxonomy",x.ref_tax,{per_page:99})||[]}:{refTaxonomy:null,refTerms:[]},[x]),b=(0,n.useSelect)(e=>x&&x.ref_types&&Array.isArray(x.ref_types)?x.ref_types.map(r=>e("core").getTaxonomy(r)).filter(e=>null!=e):[],[x]),j=(0,l.useMemo)(()=>{const e={};return b.forEach(r=>{e[r.slug]=r.labels?.name||r.name}),e},[b]),T=(0,l.useMemo)(()=>{if(!x||!x.ref_types)return[];if(y&&Array.isArray(y)&&y.length>0){const e=y.filter(e=>x.ref_types.includes(e)),r=x.ref_types.filter(r=>!e.includes(r));return[...e,...r]}return x.ref_types},[x,y]);(0,l.useEffect)(()=>{x&&x.ref_types&&!y&&a({typeOrder:x.ref_types})},[x,y,a]);const S=x&&"object"==typeof x&&x.ref_tax&&x.ref_types&&Array.isArray(x.ref_types)&&x.ref_types.length>0,O=(0,l.useRef)("");(0,l.useEffect)(()=>{if(!S)return;const e=(()=>{const e=[];if(f>0){const r=w.find(e=>e.id===f);r&&e.push(r.name)}return h>0&&e.push(h.toString()),"all"!==u&&e.push(j[u]||u),e.length>0?(0,r.__)("References","gatherpress-references")+": "+e.join(" â€¢ "):(0,r.__)("References","gatherpress-references")})();e!==O.current&&(O.current=e,a({metadata:{name:e}}))},[a,f,h,u,w,j,S]);const C=Math.min(g+1,6),k=`h${g}`,E=`h${C}`,N=(()=>{if(!S||!x.ref_types)return{};const e=(new Date).getFullYear(),r=h>0?h:e,s=()=>{const e={};return T.forEach(r=>{const s=j[r]||r;e[r]=[`${s} Example 1`,`${s} Example 2`].sort()}),e};return h>0?{[r]:s()}:{[e+" "]:s(),[e-1+" "]:s()}})(),R=(()=>{if("all"===u)return N;const e={};return Object.keys(N).forEach(r=>{const s=N[r];s[u]&&s[u].length>0&&(e[r]={[u]:s[u]})}),e})(),A=(()=>{const e=Object.keys(R);return h>0?e:e.sort((e,r)=>{const s=parseInt(e),t=parseInt(r);return"asc"===d?s-t:t-s})})(),B=0===h,P="all"===u,L="all"===u&&T.length>1;return S&&m?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.InspectorControls,{children:(0,o.jsxs)(t.PanelBody,{title:(0,r.__)("Reference Settings","gatherpress-references"),children:[_.length>1&&(0,o.jsx)(t.SelectControl,{label:(0,r.__)("Post Type","gatherpress-references"),value:i||"",options:[{label:(0,r.__)("Select post type","gatherpress-references"),value:""},..._.map(e=>({label:e.labels?.name||e.name,value:e.slug}))],onChange:e=>a({postType:e}),help:(0,r.__)("Select which post type to query for references","gatherpress-references")}),(0,o.jsx)(t.SelectControl,{label:v?.labels?.singular_name||(0,r.__)("Reference Term","gatherpress-references"),value:f,options:[{label:(0,r.__)("All (or auto-detect)","gatherpress-references"),value:0},...w.map(e=>({label:e.name,value:e.id}))],onChange:e=>a({refTermId:parseInt(e)}),help:v?.labels?.singular_name?`Select a specific ${v.labels.singular_name.toLowerCase()} or leave as auto-detect`:(0,r.__)("Select a specific reference term or leave as auto-detect","gatherpress-references")}),(0,o.jsx)(t.TextControl,{label:(0,r.__)("Year","gatherpress-references"),value:h>0?h.toString():"",onChange:e=>{const r=parseInt(e);a({year:isNaN(r)?0:r})},type:"number",min:"0",max:(new Date).getFullYear()+1,placeholder:(0,r.__)("Leave empty for all years","gatherpress-references"),help:(0,r.__)("Enter a specific year (e.g., 2024) or leave empty for all years","gatherpress-references")}),B&&(0,o.jsx)(t.ToggleControl,{label:(0,r.__)("asc"===d?"Sort Years Oldest First":"Sort Years Newest First","gatherpress-references"),checked:"asc"===d,onChange:e=>a({yearSortOrder:e?"asc":"desc"}),help:(0,r.__)("Toggle to sort years from oldest to newest. Default is newest first.","gatherpress-references")}),(0,o.jsx)(t.SelectControl,{label:(0,r.__)("Reference Type","gatherpress-references"),value:u,options:[{label:(0,r.__)("All Types","gatherpress-references"),value:"all"},...b.map(e=>({label:e.labels?.name||e.name,value:e.slug}))],onChange:e=>a({referenceType:e}),help:(0,r.__)("Choose which type of references to display","gatherpress-references")}),(0,o.jsx)(t.RangeControl,{label:(0,r.__)("Year Heading Level","gatherpress-references"),value:g,onChange:e=>a({headingLevel:e}),min:1,max:5,help:(0,r.__)("Choose the heading level for year headings (H1-H5). Type headings will be one level smaller.","gatherpress-references")})]})}),(0,o.jsx)("div",{...(0,s.useBlockProps)(),children:Object.keys(R).length>0&&(0,o.jsx)(o.Fragment,{children:A.map(e=>{const s=R[e];return(0,o.jsxs)("div",{children:[(0,o.jsx)(k,{className:"references-year",children:e}),T.map(e=>{const n=s[e];if(!n||0===n.length)return null;const l=T.indexOf(e),i=0===l,f=l===T.length-1;return(0,o.jsxs)("div",{className:"reference-type-container",children:[P&&(0,o.jsxs)("div",{className:"references-type-header",children:[(0,o.jsx)(E,{className:"references-type",children:j[e]}),L&&(0,o.jsxs)(t.ButtonGroup,{className:"references-type-movers",children:[(0,o.jsx)(t.Button,{icon:c,onClick:()=>(e=>{const r=T.indexOf(e);if(r<=0)return;const s=[...T],t=s[r-1];s[r-1]=s[r],s[r]=t,a({typeOrder:s})})(e),label:(0,r.__)("Move up","gatherpress-references"),disabled:i,isSmall:!0}),(0,o.jsx)(t.Button,{icon:p,onClick:()=>(e=>{const r=T.indexOf(e);if(-1===r||r>=T.length-1)return;const s=[...T],t=s[r+1];s[r+1]=s[r],s[r]=t,a({typeOrder:s})})(e),label:(0,r.__)("Move down","gatherpress-references"),disabled:f,isSmall:!0})]})]}),(0,o.jsx)("ul",{className:"references-list",children:n.map((e,r)=>(0,o.jsx)("li",{children:e},r))})]},e)})]},e)})})})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.InspectorControls,{children:(0,o.jsx)(t.PanelBody,{title:(0,r.__)("Reference Settings","gatherpress-references"),children:(0,o.jsx)(t.Notice,{status:"warning",isDismissible:!1,children:(0,r.__)("References block requires a post type with gatherpress_references support.","gatherpress-references")})})}),(0,o.jsx)("div",{...(0,s.useBlockProps)(),children:(0,o.jsxs)(t.Notice,{status:"warning",isDismissible:!1,children:[(0,o.jsx)("p",{children:(0,r.__)("This block requires a post type with gatherpress_references support configured.","gatherpress-references")}),_.length>0&&(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:(0,r.__)("Supported post types:","gatherpress-references")})," ",_.map(e=>e.labels?.name||e.name).join(", ")]})]})})]})}})}},s={};function t(e){var n=s[e];if(void 0!==n)return n.exports;var l=s[e]={exports:{}};return r[e](l,l.exports,t),l.exports}t.m=r,e=[],t.O=(r,s,n,l)=>{if(!s){var a=1/0;for(i=0;i<e.length;i++){for(var[s,n,l]=e[i],o=!0,c=0;c<s.length;c++)(!1&l||a>=l)&&Object.keys(t.O).every(e=>t.O[e](s[c]))?s.splice(c--,1):(o=!1,l<a&&(a=l));if(o){e.splice(i--,1);var p=n();void 0!==p&&(r=p)}}return r}l=l||0;for(var i=e.length;i>0&&e[i-1][2]>l;i--)e[i]=e[i-1];e[i]=[s,n,l]},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),(()=>{var e={57:0,350:0};t.O.j=r=>0===e[r];var r=(r,s)=>{var n,l,[a,o,c]=s,p=0;if(a.some(r=>0!==e[r])){for(n in o)t.o(o,n)&&(t.m[n]=o[n]);if(c)var i=c(t)}for(r&&r(s);p<a.length;p++)l=a[p],t.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return t.O(i)},s=globalThis.webpackChunkgatherpress_references=globalThis.webpackChunkgatherpress_references||[];s.forEach(r.bind(null,0)),s.push=r.bind(null,s.push.bind(s))})();var n=t.O(void 0,[350],()=>t(961));n=t.O(n)})();